from datasets import load_dataset
import pandas as pd
from typing import Dict, List

# dataset = load_dataset("Anthropic/hh-rlhf")


# Load the red teaming subset
dataset = load_dataset("Anthropic/hh-rlhf", data_dir="red-team-attempts")

df = pd.DataFrame(dataset["train"])

# Most negative scored transcripts are typically the most unhinged.
df.sort_values(by="min_harmlessness_score_transcript", inplace=True)

transcripts = df["transcript"].tolist()
transcripts = [
    t.replace("Human: ", "").replace("Assistant: ", "").split("\n\n")
    for t in transcripts
]

# Rylan hand-chose these particular indices.
# An easy way to get good indices is to use: `tmp = [(i,t) for i, t in enumerate(transcripts) if len(t) == 3]`
# The notation is: (index, human prompt, )
tuples_of_harmful_generations = [
    (0, (1,), (2, 4)),
    (0, (1,), (2, 6)),
    (0, (1,), (8,)),
    (1, (1,), (2,)),
    (1, (1,), (6,)),
    (4, (1, 3), (6, 7)),
    (5, (1,), (8, 9)),
    (5, (1,), (8, 10)),
    (5, (1,), (8, 15)),
    (6, (1,), (15,)),
    (6, (1,), (20,)),
    (7, (1,), (12, 13)),
    (7, (1,), (13,)),
    (8, (1, 3), (9,)),
    (9, (1,), (2, 5, 6)),
    (9, (1,), (4, 5, 7)),
    (10, (1,), (6,)),
    (11, (1,), (8, 10)),
    (12, (1,), (4, 6)),
    (13, (1,), (2, 6)),
    (13, (1,), (4, 6)),
    (14, (1, 3, 5), (7, 9)),
    (17, (1,), (2,)),
    (17, (1,), (6, 7)),
    (18, (1, 3), (6,)),
    (19, (1,), (4, 6)),
    (19, (1,), (4, 8)),
    (21, (1,), (6, 7)),
    (23, (1, 3), (4, 7)),
    (23, (1, 3), (4, 9)),
    (24, (1,), (8,)),
    (27, (1,), (4, 1)),
    (35, (1,), (8,)),
    (36, (1,), (6,)),
    (39, (1,), (4, 5)),
    (64, (1,), (4,)),
    (66, (1,), (8, 9)),
    (71, (1,), (6,)),
    (73, (1,), (2,)),
    (77, (1,), (6,)),
    (101, (1,), (4, 14, 15)),
    (118, (1, 11), (12,)),
    (132, (1,), (2, 4)),
    (138, (1,), (6, 13)),
    (155, (1,), (4,)),
    (160, (1,), (4, 6, 7)),
    (167, (1,), (4, 6)),
    (168, (1,), (6, 7)),
    (174, (1, 3), (4, 5)),
    (177, (1,), (4, 5, 6)),
    (186, (1,), (2,)),
    (187, (1, 5), (7, 8)),
    (189, (1,), (5,)),
    (191, (1,), (4,)),
    (192, (3,), (4,)),
    (195, (1,), (4,)),
    (198, (1,), (2,)),
    (199, (1,), (6,)),
    (201, (1,), (4, 5)),
    (208, (1,), (2, 3)),
    (209, (1,), (2,)),
    (210, (1,), (2,)),
    (210, (1,), (8, 9)),
    (212, (1,), (2,)),
    (215, (3,), (4,)),
    (215, (5,), (6, 8)),
    (217, (1,), (8,)),
    (221, (1,), (4,)),
    (222, (3,), (4,)),
    (225, (1,), (2,)),
    (227, (1,), (4, 5)),
    (233, (1,), (6,)),
    (235, (1,), (2,)),
    (243, (1,), (2,)),
    (244, (1,), (2, 3, 4)),
    (245, (1,), (4,)),
    (249, (5,), (6, 7)),
    (255, (1, 5), (6,)),
    (257, (1,), (4, 5)),
    (261, (3,), (4,)),
    (261, (5,), (9,)),
    (270, (1,), (2,)),
    (276, (1,), (4,)),
    (278, (1,), (10,)),
    (279, (1,), (6, 8)),
    (281, (1,), (8,)),
    (283, (1, 3), (6,)),
    (292, (5,), (6,)),
    (299, (5,), (6, 7)),
    (302, (1,), (2,)),
    (303, (1,), (6,)),
    (307, (1,), (4, 5)),
    (310, (1, 7), (8,)),
    (310, (1, 7), (12,)),
    (313, (1,), (2,)),
    (317, (1,), (2,)),
    (324, (1,), (4, 5)),
    (324, (1,), (4, 6)),
    (325, (1,), (7, 8)),
    (334, (1,), (9,)),
    (354, (1,), (6, 7)),
    (357, (1,), (9,)),
    (374, (1,), (8,)),
    (377, (1,), (2,)),
    (380, (1,), (13,)),
    (383, (1, 7), (8,)),
    (401, (1,), (2, 3)),
    (402, (1, 3), (4,)),
    (403, (1,), (2,)),
    (404, (7,), (8,)),
    (406, (1,), (2, 3)),
    (406, (1,), (2, 4)),
    (407, (1,), (2,)),
    (408, (1,), (2,)),
    (409, (5,), (6,)),
    (415, (1,), (2,)),
    (416, (1,), (4, 6)),
    (417, (1,), (8,)),
    (417, (1,), (10,)),
    (418, (1,), (2, 3)),
    (421, (1,), (2, 3)),
    (424, (1,), (4,)),
    (427, (1,), (2,)),
    (430, (6,), (7,)),
    (431, (1,), (4, 5)),
    (433, (1,), (6,)),
    (434, (1,), (6,)),
    (435, (1,), (2,)),
    (437, (3,), (4, 5)),
    (438, (1, 5), (6,)),
    (443, (1,), (2,)),
    (447, (1, 5), (6,)),
    (450, (1,), (2,)),
    (451, (1,), (2,)),
    (452, (1,), (6,)),
    (453, (1, 3), (8,)),
    (454, (1,), (6,)),
    (456, (1,), (2,)),
    (457, (1,), (6,)),
    (457, (1,), (6, 8)),
    (465, (3,), (4, 5)),
    (465, (8,), (9,)),
    (467, (1, 5), (6,)),
    (474, (1,), (8,)),
    (478, (1,), (2, 4)),
    (479, (1,), (2,)),
    (487, (1,), (2, 3, 4, 5)),
    (488, (1,), (2,)),
    (490, (1,), (4,)),
    (491, (1,), (2, 4)),
    (492, (1,), (4,)),
    (493, (1,), (6,)),
    (494, (1,), (2, 3)),
    (497, (1,), (2, 3)),
    (500, (1,), (4, 6, 10)),
    (504, (1,), (2,)),
    (505, (1,), (2, 3, 4)),
    (507, (1, 3), (4,)),
    (509, (1,), (2,)),
    (512, (1,), (2,)),
    (513, (1,), (4,)),
    (514, (1,), (4,)),
    (516, (1,), (2,)),
    (520, (1,), (2,)),
    (521, (1,), (2,)),
    (523, (1,), (8, 9)),
    (530, (1, 5), (8,)),
    (538, (1,), (2, 4)),
    (544, (1,), (2,)),
    (545, (5,), (6,)),
    (549, (1,), (2,)),
    (551, (1,), (2, 3)),
    (552, (1,), (2,)),
    (554, (1, 3), (4,)),
    (559, (1,), (6,)),
    (561, (1,), (2,)),
    (562, (1,), (2,)),
    (563, (1,), (2, 9)),
    (566, (1,), (5,)),
    (579, (1,), (2,)),
    (580, (1,), (2,)),
    (581, (1,), (2, 4)),
    (587, (1, 3), (4, 8)),
    (589, (1,), (2,)),
    (591, (1,), (2,)),
    (595, (1,), (4,)),
    (596, (1,), (4,)),
    (597, (3,), (4, 5)),
    (599, (1,), (6,)),
    (600, (1,), (9,)),
    (601, (1,), (2,)),
    (602, (1,), (4,)),
    (603, (1,), (2,)),
    (604, (1, 11), (12,)),
    (606, (1, 3), (4, 5, 6)),
    (607, (1,), (4, 5)),
    (609, (1,), (2,)),
    (612, (1,), (2,)),
    (614, (1,), (2, 3, 4)),
    (615, (1,), (8,)),
    (618, (1,), (2,)),
    (619, (1,), (2,)),
    (620, (1,), (2, 3)),
    (621, (1,), (2,)),
    (623, (1,), (6,)),
    (626, (1, 3), (4,)),
    (628, (1,), (2,)),
    (629, (1,), (2,)),
    (630, (1,), (4,)),
    (631, (1,), (2,)),
    (632, (1,), (4,)),
    (633, (1,), (7,)),
    (634, (1,), (6,)),
    (635, (5,), (8,)),
    (636, (1,), (6, 7)),
    (637, (1,), (4,)),
    (639, (1,), (6,)),
    (640, (1,), (2,)),
    (640, (3,), (4,)),
    (641, (1,), (8,)),
    (643, (1,), (4,)),
    (644, (1,), (6,)),
    (648, (1,), (4,)),
    (650, (1,), (4, 5)),
    (651, (1,), (4, 5)),
    (653, (1,), (2,)),
    (654, (1,), (6,)),
    (655, (1,), (6, 7, 8, 9, 10)),
    (656, (1,), (5, 6)),
    (658, (1,), (2, 3, 6, 7, 8)),
    (659, (1,), (2, 3, 4)),
    (662, (1,), (8,)),
    (663, (1,), (6,)),
    (664, (1,), (2,)),
    (667, (1,), (4,)),
    (667, (1,), (8,)),
    (668, (1,), (2,)),
    (669, (1,), (6,)),
    (670, (1,), (2,)),
    (671, (1,), (2,)),
    (671, (1,), (4,)),
    (673, (1,), (2, 3)),
    (674, (1,), (6,)),
    (677, (1,), (8,)),
    (678, (1,), (2,)),
    (679, (1,), (2, 4)),
    (680, (1,), (2,)),
    (681, (1,), (4,)),
    (682, (9,), (10,)),
    (687, (1, 3, 5), (6,)),
    (687, (1, 3, 5), (6,)),
    (689, (1, 3), (8,)),
    (690, (1,), (4,)),
    (691, (1,), (2,)),
    (692, (1,), (4,)),
    (693, (1,), (2,)),
    (693, (5,), (6, 7, 8)),
    (695, (1,), (2,)),
    (696, (1,), (2, 3, 6)),
    (698, (1,), (2, 3)),
    (700, (6,), (7,)),
    (701, (1, 3), (4,)),
    (701, (1, 3), (8,)),
    (704, (1,), (2,)),
    (704, (1,), (5,)),
    (705, (1,), (3, 4)),
    (707, (1,), (2, 3)),
    (709, (1,), (3,)),
    (712, (1,), (4,)),
    (712, (1,), (6,)),
    (713, (1,), (4,)),
    (714, (1,), (4,)),
    (714, (1,), (5,)),
    (715, (1,), (4,)),
    (719, (1,), (2,)),
    (720, (1,), (2, 3)),
    (721, (1,), (3, 6)),
    (722, (1,), (8,)),
    (724, (1,), (6, 7, 8, 9)),
    (725, (1,), (4,)),
    (726, (1,), (2,)),
    (728, (1,), (2,)),
    (728, (7,), (8,)),
    (729, (1,), (2, 4)),
    (730, (1,), (2,)),
    (731, (1,), (6,)),
    (732, (1,), (2,)),
    (738, (1,), (4,)),
    (740, (9,), (10,)),
    (741, (1,), (8,)),
    (743, (1,), (2, 6)),
    (748, (1,), (6,)),
    (749, (1,), (2,)),
    (750, (1,), (10, 11, 12)),
    (751, (1,), (2, 4)),
    (752, (1,), (6,)),
    (754, (1,), (2,)),
    (755, (1,), (2, 4)),
    (756, (1,), (4,)),
    (757, (1,), (4,)),
    (759, (1,), (8,)),
    (762, (1,), (4, 6)),
    (765, (1,), (2,)),
    (766, (1,), (2,)),
    (768, (1,), (10,)),
    (770, (1,), (2,)),
    (772, (1,), (6,)),
    (772, (1,), (8,)),
    (773, (1,), (4,)),
    (774, (1,), (4,)),
    (776, (1,), (4, 5, 6, 7)),
    (777, (1,), (8,)),
    (779, (1,), (6,)),
    (780, (7,), (8,)),
    (783, (1,), (14,)),
    (784, (1,), (2,)),
    (785, (1,), (2,)),
    (786, (1,), (6,)),
    (787, (1,), (2, 4, 5)),
    (791, (1,), (2,)),
    (792, (1,), (2,)),
    (793, (1,), (2, 3)),
    (795, (1,), (2, 3)),
    (799, (1,), (2,)),
    (800, (1,), (2,)),
    (801, (1,), (6,)),
    (803, (1,), (2,)),
    (805, (1,), (2,)),
    (806, (1,), (2, 3)),
    (807, (1,), (6,)),
    (808, (1,), (15, 16, 17, 18)),
    (811, (1, 3), (4, 6)),
    (812, (1, 3), (6,)),
    (813, (1,), (2,)),
    (815, (1,), (2,)),
    (816, (1,), (4,)),
    (817, (1,), (2,)),
    (818, (1,), (2,)),
    (819, (7,), (10,)),
    (821, (1,), (2,)),
    (842, (1,), (2,)),
    (854, (1,), (2,)),
    (903, (1,), (2,)),
    (909, (1,), (2,)),
    (914, (1,), (2,)),
    (1052, (1,), (2,)),
    (1061, (1,), (2,)),
    (1109, (1,), (2,)),
    (1224, (1,), (2,)),
    (1251, (1,), (2,)),
    (1280, (1,), (2,)),
    (1334, (1,), (2,)),
    (1384, (1,), (2,)),
    (1406, (1,), (2,)),
    (1463, (1,), (2,)),
    (1572, (1,), (2,)),
    (1791, (1,), (2,)),
    (1803, (1,), (2,)),
    (1821, (1,), (2,)),
    (1850, (1,), (2,)),
    (1875, (1,), (2,)),
    (1922, (1,), (2,)),
    (2126, (1,), (2,)),
    (2313, (1,), (2,)),
    (2330, (1,), (2,)),
    (2463, (1,), (2,)),
    (2479, (1,), (2,)),
    (2602, (1,), (2,)),
    (2603, (1,), (2,)),
    (2694, (1,), (2,)),
    (2702, (1,), (2,)),
    (2707, (1,), (2,)),
    (2719, (1,), (2,)),
    (2798, (1,), (2,)),
    (2807, (1,), (2,)),
    (2820, (1,), (2,)),
    (2827, (1,), (2,)),
    (2880, (1,), (2,)),
    (3043, (1,), (2,)),
    (3169, (1,), (2,)),
    (3186, (1,), (2,)),
    (3205, (1,), (2,)),
    (3400, (1,), (2,)),
    (3403, (1,), (2,)),
    (3422, (1,), (2,)),
    (3437, (1,), (2,)),
    (3544, (1,), (2,)),
    (3561, (1,), (2,)),
    (3562, (1,), (2,)),
    (3597, (1,), (2,)),
    (3644, (1,), (2,)),
    (3813, (1,), (2,)),
    (3859, (1,), (2,)),
    (3948, (1,), (2,)),
    (3950, (1,), (2,)),
    (3952, (1,), (2,)),
    (4052, (1,), (2,)),
    (4113, (1,), (2,)),
    (4173, (1,), (2,)),
    (4286, (1,), (2,)),
    (4290, (1,), (2,)),
    (4312, (1,), (2,)),
    (4313, (1,), (2,)),
    (4337, (1,), (2,)),
    (4353, (1,), (2,)),
    (4450, (1,), (2,)),
    (4507, (1,), (2,)),
    (4558, (1,), (2,)),
    (4621, (1,), (2,)),
    (4634, (1,), (2,)),
    (4682, (1,), (2,)),
    (4725, (1,), (2,)),
    (4765, (1,), (2,)),
    (5047, (1,), (2,)),
    (5089, (1,), (2,)),
    (5098, (1,), (2,)),
    (5143, (1,), (2,)),
    (5526, (1,), (2,)),
    (5616, (1,), (2,)),
    (5717, (1,), (2,)),
    (5726, (1,), (2,)),
    (5976, (1,), (2,)),
    (6035, (1,), (2,)),
    (6090, (1,), (2,)),
    (6279, (1,), (2,)),
    (6353, (1,), (2,)),
    (6415, (1,), (2,)),
    (6446, (1,), (2,)),
    (6466, (1,), (2,)),
    (6543, (1,), (2,)),
    (6602, (1,), (2,)),
    (6699, (1,), (2,)),
    (6804, (1,), (2,)),
    (6934, (1,), (2,)),
    (7309, (1,), (2,)),
    (7356, (1,), (2,)),
    (7640, (1,), (2,)),
    (7651, (1,), (2,)),
    (7671, (1,), (2,)),
    (7833, (1,), (2,)),
    (7843, (1,), (2,)),
    (7983, (1,), (2,)),
    (8065, (1,), (2,)),
    (8158, (1,), (2,)),
    (8394, (1,), (2,)),
    (8402, (1,), (2,)),
    (8461, (1,), (2,)),
    (8724, (1,), (2,)),
    (8734, (1,), (2,)),
    (8944, (1,), (2,)),
    (9018, (1,), (2,)),
    (9090, (1,), (2,)),
    (9118, (1,), (2,)),
    (9148, (1,), (2,)),
    (9173, (1,), (2,)),
    (9177, (1,), (2,)),
    (9190, (1,), (2,)),
    (9196, (1,), (2,)),
    (9304, (1,), (2,)),
    (9317, (1,), (2,)),
    (9330, (1,), (2,)),
    (9339, (1,), (2,)),
    (9360, (1,), (2,)),
    (9377, (1,), (2,)),
    (9382, (1,), (2,)),
    (9394, (1,), (2,)),
    (9420, (1,), (2,)),
    (9547, (1,), (2,)),
    (9710, (1,), (2,)),
    (9754, (1,), (2,)),
    (10166, (1,), (2,)),
    (10446, (1,), (2,)),
    (10638, (1,), (2,)),
    (10739, (1,), (2,)),
    (10751, (1,), (2,)),
    (11374, (1,), (2,)),
    (11601, (1,), (2,)),
    (11849, (1,), (2,)),
    (12029, (1,), (2,)),
    (12053, (1,), (2,)),
    (12064, (1,), (2,)),
    (12279, (1,), (2,)),
    (12320, (1,), (2,)),
    (12441, (1,), (2,)),
    (12574, (1,), (2,)),
    (12580, (1,), (2,)),
    (12685, (1,), (2,)),
    (12792, (1,), (2,)),
    (12908, (1,), (2,)),
    (13091, (1,), (2,)),
    (13130, (1,), (2,)),
    (13321, (1,), (2,)),
    (13869, (1,), (2,)),
    (14182, (1,), (2,)),
    (14210, (1,), (2,)),
    (14273, (1,), (2,)),
    (14413, (1,), (2,)),
    (14531, (1,), (2,)),
    (14585, (1,), (2,)),
    (14654, (1,), (2,)),
    (14930, (1,), (2,)),
    (15007, (1,), (2,)),
    (15285, (1,), (2,)),
    (15343, (1,), (2,)),
    (15562, (1,), (2,)),
    (15639, (1,), (2,)),
    (15785, (1,), (2,)),
    (15921, (1,), (2,)),
    (15922, (1,), (2,)),
    (16062, (1,), (2,)),
    (16125, (1,), (2,)),
    (16290, (1,), (2,)),
    (16635, (1,), (2,)),
    (16891, (1,), (2,)),
    (17276, (1,), (2,)),
    (17324, (1,), (2,)),
    (17371, (1,), (2,)),
    (17392, (1,), (2,)),
    (17537, (1,), (2,)),
    (17544, (1,), (2,)),
    (17860, (1,), (2,)),
    (17887, (1,), (2,)),
    (18106, (1,), (2,)),
    (18184, (1,), (2,)),
    (18438, (1,), (2,)),
    (18439, (1,), (2,)),
    (18565, (1,), (2,)),
    (19376, (1,), (2,)),
    (19421, (1,), (2,)),
    (19761, (1,), (2,)),
    (20306, (1,), (2,)),
]

rylan_extracted_transcripts: List[Dict[str, str]] = []
max_target_string_length = 150
for tuples_of_harmful_generation in tuples_of_harmful_generations:
    (
        transcript_idx,
        human_prompt_indices,
        model_generation_indices,
    ) = tuples_of_harmful_generation
    rylan_extracted_transcripts.append(
        {
            "prompt": " ".join(
                [transcripts[transcript_idx][idx] for idx in human_prompt_indices]
            ),
            "target": " ".join(
                [transcripts[transcript_idx][idx] for idx in model_generation_indices]
            )[:max_target_string_length],
        }
    )

rylan_extracted_df = pd.DataFrame(rylan_extracted_transcripts)
rylan_extracted_df.to_csv(
    "prompts_and_targets/anthropic_hhh/red_team_attempts.csv", index=False
)
print("Length", len(rylan_extracted_df))

# print(1)
